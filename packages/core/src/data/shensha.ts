// 神煞规则数据（通用口径）。如需采用其它流派，请在此添加/替换规则。

export type ShenShaRule = {
  name: string;
  group: '贵人' | '吉曜' | '煞曜';
  lineage?: string; // 'common' | 'ziping' | ...
  mode: 'byDayStemMap' | 'byDayBranchMap' | 'byYearBranchMap' | 'byMonthBranchMap' | 'sanHe' | 'sixConflict' | 'sixHarm' | 'threeClash' | 'selfClash' | 'bySpecialDayPillar' | 'byMonthMap' | 'bySeasonMap' | 'byNayin';
  // 将"键→支(数组)"映射到命中支
  map?: Record<string, string | string[]>;
  // 特殊日柱列表（用于魁罡、日德、金神等）
  specialPillars?: string[];
  // 季节映射（用于四废、四忌等）
  seasonMap?: Record<string, string[]>;
  // 关系类神煞的配对关系
  relations?: Array<{from: string; to: string; relation: string}>;
  // sanHe 模式下，name 仅支持 桃花/驿马/华盖，分组固定为吉曜
};

const toArr = (v: string | string[]) => Array.isArray(v) ? v : [v];

export const SHENSHA_RULES: ShenShaRule[] = [
  // 三合类（依日支所在三合局派位）
  { name: '桃花', group: '吉曜', mode: 'sanHe' },
  { name: '驿马', group: '吉曜', mode: 'sanHe' },
  { name: '华盖', group: '吉曜', mode: 'sanHe' },

  // 一、贵人类神煞
  { name: '天乙贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲': ['丑','未'], '戊': ['丑','未'], '庚': ['丑','未'],
    '乙': ['子','申'], '己': ['子','申'],
    '丙': ['亥','酉'], '丁': ['亥','酉'],
    '辛': ['寅','午'],
    '壬': ['卯','巳'], '癸': ['卯','巳']
  } },
  { name: '太极贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':['子','午'],'乙':['子','午'],'丙':['卯','酉'],'丁':['卯','酉'],'戊':['辰','戌'],
    '己':['巳','亥'],'庚':['丑','未'],'辛':['丑','未'],'壬':['寅','申'],'癸':['寅','申']
  } },
  { name: '天德贵人', group: '贵人', mode: 'byMonthMap', map: {
    '1':'丁','2':'申','3':'壬','4':'辛','5':'亥','6':'甲',
    '7':'癸','8':'寅','9':'丙','10':'乙','11':'巳','12':'庚'
  } },
  { name: '月德贵人', group: '贵人', mode: 'byMonthBranchMap', map: {
    '寅':'丙','午':'丙','戌':'丙',
    '申':'壬','子':'壬','辰':'壬',
    '亥':'甲','卯':'甲','未':'甲',
    '巳':'庚','酉':'庚','丑':'庚'
  } },
  { name: '德秀贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':['己','丑','未'],'乙':['庚','申','寅'],'丙':['辛','酉','卯'],'丁':['壬','子','午'],'戊':['癸','亥','巳'],
    '己':['甲','寅','申'],'庚':['乙','卯','酉'],'辛':['丙','午','子'],'壬':['丁','巳','亥'],'癸':['戊','申','寅']
  } },
  { name: '三奇贵人', group: '贵人', mode: 'bySpecialDayPillar', specialPillars: ['甲戊庚','乙丙丁','壬癸辛'] },
  { name: '福星贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':'寅','乙':'卯','丙':'巳','丁':'午','戊':'巳','己':'午','庚':'申','辛':'酉','壬':'亥','癸':'子'
  } },
  { name: '文昌贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':'巳','乙':'午','丙':'申','丁':'酉','戊':'申','己':'酉','庚':'亥','辛':'子','壬':'寅','癸':'卯'
  } },
  { name: '国印贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':'戌','乙':'亥','丙':'丑','丁':'寅','戊':'丑','己':'寅','庚':'辰','辛':'巳','壬':'未','癸':'申'
  } },
  { name: '天官贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':'丁','乙':'申','丙':'丁','丁':'酉','戊':'己','己':'子','庚':'辛','辛':'寅','壬':'癸','癸':'卯'
  } },
  { name: '天福贵人', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':'酉','乙':'申','丙':'亥','丁':'戌','戊':'亥','己':'戌','庚':'丑','辛':'子','壬':'卯','癸':'寅'
  } },

  // 二、禄马类神煞
  { name: '禄神', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'寅','乙':'卯','丙':'巳','丁':'午','戊':'巳','己':'午','庚':'申','辛':'酉','壬':'亥','癸':'子'
  } },
  { name: '天马', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'寅','乙':'卯','丙':'巳','丁':'午','戊':'巳','己':'午','庚':'申','辛':'酉','壬':'亥','癸':'子'
  } },
  { name: '学堂', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'巳','乙':'午','丙':'寅','丁':'卯','戊':'寅','己':'卯','庚':'亥','辛':'子','壬':'申','癸':'酉'
  } },
  { name: '词馆', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'午','乙':'巳','丙':'申','丁':'酉','戊':'申','己':'酉','庚':'子','辛':'亥','壬':'寅','癸':'卯'
  } },

  // 三、刃煞类神煞
  { name: '羊刃', group: '煞曜', mode: 'byDayStemMap', map: {
    '甲':'卯','乙':'寅','丙':'午','丁':'巳','戊':'午','己':'巳','庚':'酉','辛':'申','壬':'子','癸':'亥'
  } },
  { name: '飞刃', group: '煞曜', mode: 'byDayStemMap', map: {
    '甲':'酉','乙':'戌','丙':'子','丁':'丑','戊':'子','己':'丑','庚':'卯','辛':'辰','壬':'午','癸':'未'
  } },
  { name: '劫煞', group: '煞曜', mode: 'sanHe', map: {
    '申子辰':'巳','寅午戌':'亥','巳酉丑':'寅','亥卯未':'申'
  } },
  { name: '灾煞', group: '煞曜', mode: 'sanHe', map: {
    '申子辰':'午','寅午戌':'子','巳酉丑':'卯','亥卯未':'酉'
  } },
  { name: '天煞', group: '煞曜', mode: 'sanHe', map: {
    '申子辰':'未','寅午戌':'丑','巳酉丑':'辰','亥卯未':'戌'
  } },

  // 四、桃花类神煞
  { name: '咸池桃花', group: '吉曜', mode: 'sanHe', map: {
    '申子辰':'酉','寅午戌':'卯','巳酉丑':'午','亥卯未':'子'
  } },
  { name: '红艳', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'午','乙':'申','丙':'寅','丁':'未','戊':'辰','己':'辰','庚':'戌','辛':'酉','壬':'子','癸':'申'
  } },
  { name: '红鸾', group: '吉曜', mode: 'byYearBranchMap', map: {
    '子':'卯','丑':'寅','寅':'丑','卯':'子','辰':'亥','巳':'戌','午':'酉','未':'申','申':'未','酉':'午','戌':'巳','亥':'辰'
  } },
  { name: '天喜', group: '吉曜', mode: 'byYearBranchMap', map: {
    '子':'酉','丑':'申','寅':'未','卯':'午','辰':'巳','巳':'辰','午':'卯','未':'寅','申':'丑','酉':'子','戌':'亥','亥':'戌'
  } },
  { name: '流霞', group: '煞曜', mode: 'byDayStemMap', map: {
    '甲':'酉','乙':'戌','丙':'亥','丁':'子','戊':'丑','己':'寅','庚':'卯','辛':'辰','壬':'巳','癸':'午'
  } },

  // 五、孤寡类神煞
  { name: '孤辰', group: '煞曜', mode: 'byYearBranchMap', map: {
    '亥':'寅','子':'寅','丑':'寅','寅':'巳','卯':'巳','辰':'巳','巳':'申','午':'申','未':'申','申':'亥','酉':'亥','戌':'亥'
  } },
  { name: '寡宿', group: '煞曜', mode: 'byYearBranchMap', map: {
    '亥':'戌','子':'戌','丑':'戌','寅':'丑','卯':'丑','辰':'丑','巳':'辰','午':'辰','未':'辰','申':'未','酉':'未','戌':'未'
  } },
  { name: '孤鸾煞', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['乙巳','丁巳','辛亥','戊申','甲寅','戊午','壬子','丙午'] },
  { name: '阴阳差错', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['丙子','丁丑','戊寅','辛卯','壬辰','癸巳','丙午','丁未','戊申','辛酉','壬戌','癸亥'] },

  // 六、华盖将星类
  { name: '将星', group: '吉曜', mode: 'sanHe', map: {
    '申子辰':'子','寅午戌':'午','巳酉丑':'酉','亥卯未':'卯'
  } },
  { name: '金舆', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'辰','乙':'巳','丙':'未','丁':'申','戊':'未','己':'申','庚':'戌','辛':'亥','壬':'丑','癸':'寅'
  } },

  // 七、空亡类神煞
  { name: '截路空亡', group: '煞曜', mode: 'byDayStemMap', map: {
    '甲':'亥','己':'亥','乙':'子','庚':'子','丙':'丑','辛':'丑','丁':'寅','壬':'寅','戊':'卯','癸':'卯'
  } },

  // 八、刑冲害类
  { name: '三刑', group: '煞曜', mode: 'threeClash', relations: [
    {from:'寅',to:'巳',relation:'相刑'},{from:'巳',to:'申',relation:'相刑'},{from:'申',to:'寅',relation:'相刑'},
    {from:'丑',to:'戌',relation:'相刑'},{from:'戌',to:'未',relation:'相刑'},{from:'未',to:'丑',relation:'相刑'},
    {from:'子',to:'卯',relation:'相刑'},{from:'卯',to:'子',relation:'相刑'}
  ] },
  { name: '六冲', group: '煞曜', mode: 'sixConflict', relations: [
    {from:'子',to:'午',relation:'相冲'},{from:'午',to:'子',relation:'相冲'},
    {from:'丑',to:'未',relation:'相冲'},{from:'未',to:'丑',relation:'相冲'},
    {from:'寅',to:'申',relation:'相冲'},{from:'申',to:'寅',relation:'相冲'},
    {from:'卯',to:'酉',relation:'相冲'},{from:'酉',to:'卯',relation:'相冲'},
    {from:'辰',to:'戌',relation:'相冲'},{from:'戌',to:'辰',relation:'相冲'},
    {from:'巳',to:'亥',relation:'相冲'},{from:'亥',to:'巳',relation:'相冲'}
  ] },
  { name: '六害', group: '煞曜', mode: 'sixHarm', relations: [
    {from:'子',to:'未',relation:'相害'},{from:'未',to:'子',relation:'相害'},
    {from:'丑',to:'午',relation:'相害'},{from:'午',to:'丑',relation:'相害'},
    {from:'寅',to:'巳',relation:'相害'},{from:'巳',to:'寅',relation:'相害'},
    {from:'卯',to:'辰',relation:'相害'},{from:'辰',to:'卯',relation:'相害'},
    {from:'申',to:'亥',relation:'相害'},{from:'亥',to:'申',relation:'相害'},
    {from:'酉',to:'戌',relation:'相害'},{from:'戌',to:'酉',relation:'相害'}
  ] },
  { name: '自刑', group: '煞曜', mode: 'selfClash', map: {
    '辰':'辰','午':'午','酉':'酉','亥':'亥'
  } },

  // 九、疾病类神煞
  { name: '病符', group: '煞曜', mode: 'byDayBranchMap', map: {
    '子':'卯','丑':'辰','寅':'巳','卯':'午','辰':'未','巳':'申','午':'酉','未':'戌','申':'亥','酉':'子','戌':'丑','亥':'寅'
  } },
  { name: '死符', group: '煞曜', mode: 'byDayBranchMap', map: {
    '子':'酉','丑':'戌','寅':'亥','卯':'子','辰':'丑','巳':'寅','午':'卯','未':'辰','申':'巳','酉':'午','戌':'未','亥':'申'
  } },
  { name: '天医', group: '贵人', mode: 'byDayBranchMap', map: {
    '子':'未','丑':'申','寅':'酉','卯':'戌','辰':'亥','巳':'子','午':'丑','未':'寅','申':'卯','酉':'辰','戌':'巳','亥':'午'
  } },
  { name: '天寿星', group: '贵人', mode: 'byDayStemMap', map: {
    '甲':'巳','乙':'午','丙':'申','丁':'酉','戊':'申','己':'酉','庚':'亥','辛':'子','壬':'寅','癸':'卯'
  } },

  // 十、丧吊类神煞
  { name: '丧门', group: '煞曜', mode: 'byDayBranchMap', map: {
    '子':'寅','丑':'卯','寅':'辰','卯':'巳','辰':'午','巳':'未','午':'申','未':'酉','申':'戌','酉':'亥','戌':'子','亥':'丑'
  } },
  { name: '吊客', group: '煞曜', mode: 'byDayBranchMap', map: {
    '子':'戌','丑':'亥','寅':'子','卯':'丑','辰':'寅','巳':'卯','午':'辰','未':'巳','申':'午','酉':'未','戌':'申','亥':'酉'
  } },
  { name: '披麻', group: '煞曜', mode: 'byDayBranchMap', map: {
    '子':'未','丑':'申','寅':'酉','卯':'戌','辰':'亥','巳':'子','午':'丑','未':'寅','申':'卯','酉':'辰','戌':'巳','亥':'午'
  } },
  { name: '白虎', group: '煞曜', mode: 'byDayBranchMap', map: {
    '子':'申','丑':'酉','寅':'戌','卯':'亥','辰':'子','巳':'丑','午':'寅','未':'卯','申':'辰','酉':'巳','戌':'午','亥':'未'
  } },

  // 十一、特殊格局神煞
  { name: '魁罡', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['庚戌','庚辰','壬辰','戊戌'] },
  { name: '日德', group: '贵人', mode: 'bySpecialDayPillar', specialPillars: ['甲寅','丙辰','戊辰','庚辰','壬戌'] },
  { name: '金神', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['乙丑','己巳','癸酉'] },
  { name: '四废', group: '煞曜', mode: 'bySeasonMap', seasonMap: {
    '春':['庚申','辛酉'],'夏':['壬子','癸亥'],'秋':['甲寅','乙卯'],'冬':['丙午','丁巳']
  } },
  { name: '四忌', group: '煞曜', mode: 'bySeasonMap', seasonMap: {
    '春':['乙卯'],'夏':['丁午'],'秋':['辛酉'],'冬':['癸子']
  } },

  // 十二、天罗地网类
  { name: '天罗', group: '煞曜', mode: 'byYearBranchMap', map: {
    '戌':'戌','亥':'亥'
  } },
  { name: '地网', group: '煞曜', mode: 'byYearBranchMap', map: {
    '辰':'辰','巳':'巳'
  } },

  // 十三、童子花姐类（简化处理）
  { name: '童子煞', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['春秋寅子贵','冬夏卯未辰','金木马卯合','水火鸡犬多','土命逢辰巳'] },
  { name: '花姐煞', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['春秋花姐是前五','冬夏花姐是后五'] },

  // 十八、时辰神煞
  { name: '日禄归时', group: '吉曜', mode: 'byDayStemMap', map: {
    '甲':'亥','乙':'子','丙':'寅','丁':'卯','戊':'寅','己':'卯','庚':'巳','辛':'午','壬':'申','癸':'酉'
  } },

  // 十九、败财破家类神煞
  { name: '十恶大败', group: '煞曜', mode: 'bySpecialDayPillar', specialPillars: ['甲辰','乙巳','丙申','丁亥','戊戌','己丑','庚辰','辛巳','壬申','癸亥'] },
  { name: '铁扫帚', group: '煞曜', mode: 'byYearBranchMap', map: {
    '申':'正七十','子':'正七十','辰':'正七十',
    '寅':'三九十二','午':'三九十二','戌':'三九十二',
    '巳':'四八十一','酉':'四八十一','丑':'四八十一',
    '亥':'二六九','卯':'二六九','未':'二六九'
  } },
  { name: '破月', group: '煞曜', mode: 'byYearBranchMap', map: {
    '巳':'正','子':'二','丑':'三','申':'四','卯':'五','戌':'六',
    '亥':'七','午':'八','未':'九','酉':'十','寅':'十一','辰':'十二'
  } },
  { name: '绝火', group: '煞曜', mode: 'byYearBranchMap', map: {
    '子':'巳','午':'巳','卯':'巳','酉':'巳',
    '寅':'酉','申':'酉','巳':'酉','亥':'酉',
    '辰':'丑','戌':'丑','丑':'丑','未':'丑'
  } },

  // 咸池（桃花）- 保持原有规则
  { name: '咸池', group: '吉曜', mode: 'byYearBranchMap', map: {
    '申':'酉','子':'酉','辰':'酉','寅':'卯','午':'卯','戌':'卯','巳':'午','酉':'午','丑':'午','亥':'子','卯':'子','未':'子'
  } }
];

export { toArr };


