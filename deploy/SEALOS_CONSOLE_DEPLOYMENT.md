# Destiny 项目 Sealos 控制台直接部署指南

通过 Sealos 控制台直接从源码部署，无需本地构建 Docker 镜像。

## 🚀 快速部署步骤

### 第一步：准备代码仓库

1. **确保代码已推送到 Git 仓库**
   - GitHub: https://github.com/your-username/destiny
   - GitLab: https://gitlab.com/your-username/destiny
   - 或其他 Git 托管服务

2. **确保仓库是公开的**（或配置访问权限）

### 第二步：登录 Sealos Cloud

1. 访问：https://cloud.sealos.io/
2. 注册/登录您的账户
3. 进入控制台界面

### 第三步：部署 API 服务

1. **创建应用**
   - 点击左侧菜单「应用管理」
   - 点击「创建应用」
   - 选择「从源码构建」

2. **配置 API 应用**
   ```
   应用名称: destiny-api
   Git 仓库地址: https://github.com/your-username/destiny
   分支: main
   构建上下文: ./
   Dockerfile 路径: apps/api/Dockerfile
   端口: 3001
   ```

3. **环境变量配置**
   ```
   NODE_ENV=production
   PORT=3001
   ```

4. **资源配置**
   ```
   CPU: 0.5 核
   内存: 1Gi
   存储: 1Gi
   副本数: 1
   ```

5. **点击「部署」**

### 第四步：配置 API 服务域名

1. **等待 API 服务部署完成**
2. **配置外网访问**
   - 在应用详情页，点击「网络」
   - 启用「外网访问」
   - 系统会自动分配一个域名，如：`destiny-api-xxx.cloud.sealos.io`
   - 记录此域名，后续 Web 应用需要用到

### 第五步：部署 Web 服务

1. **创建新应用**
   - 再次点击「创建应用」
   - 选择「从源码构建」

2. **配置 Web 应用**
   ```
   应用名称: destiny-web
   Git 仓库地址: https://github.com/your-username/destiny
   分支: main
   构建上下文: ./
   Dockerfile 路径: apps/web/Dockerfile
   端口: 80
   ```

3. **环境变量配置**
   ```
   VITE_API_URL=https://destiny-api-xxx.cloud.sealos.io
   ```
   > 🔥 **重要**：将上面的 URL 替换为第四步中获得的 API 域名

4. **资源配置**
   ```
   CPU: 0.2 核
   内存: 512Mi
   存储: 1Gi
   副本数: 1
   ```

5. **点击「部署」**

### 第六步：配置 Web 服务域名

1. **等待 Web 服务部署完成**
2. **配置外网访问**
   - 在 Web 应用详情页，点击「网络」
   - 启用「外网访问」
   - 系统会分配域名，如：`destiny-web-xxx.cloud.sealos.io`

### 第七步：验证部署

1. **测试 API 服务**
   - 访问：`https://destiny-api-xxx.cloud.sealos.io/health`
   - 应该返回健康状态

2. **访问 Web 应用**
   - 访问：`https://destiny-web-xxx.cloud.sealos.io`
   - 验证八字计算功能是否正常

## 🎯 Sealos 控制台操作界面指南

### 创建应用界面说明

```
┌─────────────────────────────────────────┐
│  创建应用                                │
├─────────────────────────────────────────┤
│ 应用名称: [destiny-api            ]     │
│ 镜像来源: ○ 镜像仓库  ● 源码构建        │
├─────────────────────────────────────────┤
│ Git 仓库                                │
│ 仓库地址: [github.com/user/destiny]     │
│ 分支:     [main                  ]     │
│ 构建路径: [./                    ]     │
│ Dockerfile: [apps/api/Dockerfile ]     │
├─────────────────────────────────────────┤
│ 容器配置                                │
│ 端口:     [3001                  ]     │
│ CPU:      [0.5                   ] 核  │
│ 内存:     [1                     ] Gi  │
├─────────────────────────────────────────┤
│ 环境变量                                │
│ NODE_ENV=production                     │
│ PORT=3001                               │
├─────────────────────────────────────────┤
│          [取消]        [部署]          │
└─────────────────────────────────────────┘
```

### 网络配置界面

```
┌─────────────────────────────────────────┐
│  网络配置                                │
├─────────────────────────────────────────┤
│ 内网访问: ● 启用  ○ 禁用                │
│ 端口: 3001                              │
├─────────────────────────────────────────┤
│ 外网访问: ● 启用  ○ 禁用                │
│ 域名: destiny-api-xxx.cloud.sealos.io   │
│ 端口: 443 (HTTPS)                       │
├─────────────────────────────────────────┤
│ 自定义域名 (可选)                        │
│ 域名: [your-domain.com          ]      │
├─────────────────────────────────────────┤
│          [取消]        [保存]          │
└─────────────────────────────────────────┘
```

## 🔧 常见问题解决

### Q1: 构建失败
**现象**: 应用状态显示构建失败
**解决**:
1. 检查 Dockerfile 路径是否正确
2. 查看构建日志，定位具体错误
3. 确保代码仓库可访问

### Q2: 应用无法启动
**现象**: 部署成功但应用状态异常
**解决**:
1. 检查端口配置是否正确
2. 查看应用日志
3. 验证环境变量设置

### Q3: 网络访问失败
**现象**: 无法通过域名访问应用
**解决**:
1. 确认外网访问已启用
2. 检查端口配置
3. 等待 DNS 解析生效（1-2分钟）

### Q4: API 连接失败
**现象**: Web 应用无法连接 API
**解决**:
1. 确认 `VITE_API_URL` 环境变量正确
2. 检查 API 服务是否正常运行
3. 验证 CORS 配置

## 📊 监控和管理

### 查看应用状态
- 应用列表页面显示运行状态
- 绿色：运行正常
- 红色：运行异常
- 黄色：部署中

### 查看日志
1. 进入应用详情页
2. 点击「日志」标签
3. 实时查看应用运行日志

### 扩缩容
1. 进入应用详情页
2. 点击「伸缩」
3. 调整副本数或资源配置

### 更新应用
1. 代码推送到 Git 仓库
2. 在 Sealos 控制台点击「重新部署」
3. 系统自动拉取最新代码并构建

## 🎉 完成！

按照以上步骤，您的 Destiny 八字计算平台就成功部署到 Sealos Cloud 了！

**最终访问地址**：
- Web 应用：`https://destiny-web-xxx.cloud.sealos.io`
- API 服务：`https://destiny-api-xxx.cloud.sealos.io`

其他人现在可以通过 Web 应用的域名访问您的八字计算平台了！
